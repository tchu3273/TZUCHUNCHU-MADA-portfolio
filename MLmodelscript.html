<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Machine Learning Model fitting</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/journal.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  { color: #cccccc; background-color: #303030; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ffcfaf; } /* Alert */
code span.an { color: #7f9f7f; font-weight: bold; } /* Annotation */
code span.at { } /* Attribute */
code span.bn { color: #dca3a3; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #f0dfaf; } /* ControlFlow */
code span.ch { color: #dca3a3; } /* Char */
code span.cn { color: #dca3a3; font-weight: bold; } /* Constant */
code span.co { color: #7f9f7f; } /* Comment */
code span.cv { color: #7f9f7f; font-weight: bold; } /* CommentVar */
code span.do { color: #7f9f7f; } /* Documentation */
code span.dt { color: #dfdfbf; } /* DataType */
code span.dv { color: #dcdccc; } /* DecVal */
code span.er { color: #c3bf9f; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #c0bed1; } /* Float */
code span.fu { color: #efef8f; } /* Function */
code span.im { } /* Import */
code span.in { color: #7f9f7f; font-weight: bold; } /* Information */
code span.kw { color: #f0dfaf; } /* Keyword */
code span.op { color: #f0efd0; } /* Operator */
code span.ot { color: #efef8f; } /* Other */
code span.pp { color: #ffcfaf; font-weight: bold; } /* Preprocessor */
code span.sc { color: #dca3a3; } /* SpecialChar */
code span.ss { color: #cc9393; } /* SpecialString */
code span.st { color: #cc9393; } /* String */
code span.va { } /* Variable */
code span.vs { color: #cc9393; } /* VerbatimString */
code span.wa { color: #7f9f7f; font-weight: bold; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>







<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">My Data Analysis Portfolio</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="./aboutme.html">About Me</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Projects
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="./rcoding.html">R Coding</a>
    </li>
    <li>
      <a href="./visualization.html">Visualization</a>
    </li>
    <li>
      <a href="./tidytuesday.html">Tidy Tuesday</a>
    </li>
    <li>
      <a href="./tidytuesday2.html">Tidy Tuesday 2</a>
    </li>
    <li class="dropdown-submenu">
      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Influenza Data Analysis Project</a>
      <ul class="dropdown-menu" role="menu">
        <li>
          <a href="./exploration.html">Exploratory Data Analysis</a>
        </li>
        <li>
          <a href="./basicanalysisscript.html">Basic Statistical Models</a>
        </li>
        <li>
          <a href="./evaluationscript.html">Model Fitting Evaluation</a>
        </li>
        <li>
          <a href="./MLModelscript.html">Machine Learning Models</a>
        </li>
      </ul>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/tchu3273/TZUCHUNCHU-MADA-portfolio">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Machine Learning Model fitting</h1>

</div>


<p>For this exercise, I used a influenza data provided by Dr. Handel to fit a tree-based, a LASSO model and a random forest,then compare their model performances and choose one model that best fit the data based on the tuning process. The purpose of the analysis is to create, process and validate a predictive model for predicting future outcome, which is body temperature in this exercise. You can find the full steps of data cleaning, wrangling, statistical analysis and other relevant scripts on the “Tzu-Chun-MADA-analysis3” repository.</p>
<div id="load-needed-packages" class="section level2">
<h2>Load needed packages</h2>
</div>
<div id="load-data" class="section level2">
<h2>load data</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>processdata &lt;-<span class="st"> </span><span class="kw">readRDS</span>(here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;file&quot;</span>,<span class="st">&quot;processeddata.rds&quot;</span>))</span></code></pre></div>
</div>
<div id="pre-processing" class="section level2">
<h2>Pre-processing</h2>
<pre><code>## &#39;data.frame&#39;:    730 obs. of  32 variables:
##  $ SwollenLymphNodes: Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 1 1 1 2 1 ...
##  $ ChestCongestion  : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 2 2 2 1 1 1 2 2 2 ...
##  $ ChillsSweats     : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 2 2 2 2 2 2 1 ...
##  $ NasalCongestion  : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 2 2 2 1 1 1 2 2 2 ...
##  $ CoughYN          : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 1 2 1 2 2 2 2 2 ...
##  $ Sneeze           : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 2 1 2 1 2 1 1 ...
##  $ Fatigue          : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ SubjectiveFever  : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 2 2 1 ...
##  $ Headache         : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 1 2 2 2 ...
##  $ Weakness         : Factor w/ 4 levels &quot;None&quot;,&quot;Mild&quot;,..: 2 4 4 4 3 3 2 4 3 3 ...
##  $ WeaknessYN       : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ CoughIntensity   : Factor w/ 4 levels &quot;None&quot;,&quot;Mild&quot;,..: 4 4 2 3 1 3 4 3 3 3 ...
##  $ CoughYN2         : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 1 2 2 2 2 2 ...
##  $ Myalgia          : Factor w/ 4 levels &quot;None&quot;,&quot;Mild&quot;,..: 2 4 4 4 2 3 2 4 3 2 ...
##  $ MyalgiaYN        : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 2 2 2 ...
##  $ RunnyNose        : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 2 1 1 2 2 2 2 ...
##  $ AbPain           : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 1 1 1 1 1 1 1 ...
##  $ ChestPain        : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 1 1 2 2 1 1 1 ...
##  $ Diarrhea         : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 2 1 1 1 1 ...
##  $ EyePn            : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 2 1 1 1 1 1 ...
##  $ Insomnia         : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 2 2 1 1 2 2 2 ...
##  $ ItchyEye         : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Nausea           : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 2 2 2 1 1 2 2 ...
##  $ EarPn            : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 2 1 2 1 1 1 1 1 1 ...
##  $ Hearing          : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 2 1 1 1 1 1 1 1 1 ...
##  $ Pharyngitis      : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 2 2 2 2 2 2 2 1 1 1 ...
##  $ Breathless       : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 1 1 2 1 1 1 2 ...
##  $ ToothPn          : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 2 1 1 1 1 1 2 1 ...
##  $ Vision           : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ Vomit            : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 1 1 1 2 1 1 1 ...
##  $ Wheeze           : Factor w/ 2 levels &quot;No&quot;,&quot;Yes&quot;: 1 1 1 2 1 2 1 1 1 1 ...
##  $ BodyTemp         : num  98.3 100.4 100.8 98.8 100.5 ...
##  - attr(*, &quot;na.action&quot;)= &#39;omit&#39; Named int [1:5] 133 243 363 577 585
##   ..- attr(*, &quot;names&quot;)= chr [1:5] &quot;133&quot; &quot;243&quot; &quot;363&quot; &quot;577&quot; ...</code></pre>
<pre><code>##  SwollenLymphNodes ChestCongestion ChillsSweats NasalCongestion Sneeze   
##  No :418           No :323         No :130      No :167         No :339  
##  Yes:312           Yes:407         Yes:600      Yes:563         Yes:391  
##                                                                          
##                                                                          
##                                                                          
##                                                                          
##  Fatigue   SubjectiveFever Headache      Weakness    CoughIntensity
##  No : 64   No :230         No :115   None    : 49   None    : 47   
##  Yes:666   Yes:500         Yes:615   Mild    :223   Mild    :154   
##                                      Moderate:338   Moderate:357   
##                                      Severe  :120   Severe  :172   
##                                                                    
##                                                                    
##      Myalgia    RunnyNose AbPain    ChestPain Diarrhea  EyePn     Insomnia 
##  None    : 79   No :211   No :639   No :497   No :631   No :617   No :315  
##  Mild    :213   Yes:519   Yes: 91   Yes:233   Yes: 99   Yes:113   Yes:415  
##  Moderate:325                                                              
##  Severe  :113                                                              
##                                                                            
##                                                                            
##  ItchyEye  Nausea    EarPn     Hearing   Pharyngitis Breathless ToothPn  
##  No :551   No :475   No :568   No :700   No :119     No :436    No :565  
##  Yes:179   Yes:255   Yes:162   Yes: 30   Yes:611     Yes:294    Yes:165  
##                                                                          
##                                                                          
##                                                                          
##                                                                          
##  Vision    Vomit     Wheeze       BodyTemp     
##  No :711   No :652   No :510   Min.   : 97.20  
##  Yes: 19   Yes: 78   Yes:220   1st Qu.: 98.20  
##                                Median : 98.50  
##                                Mean   : 98.94  
##                                3rd Qu.: 99.30  
##                                Max.   :103.10</code></pre>
</div>
<div id="data-setup" class="section level2">
<h2>Data setup</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Data Splitting------------------------------------------------------</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="co">#set seed to fix random numbers </span></span>
<span id="cb4-3"><a href="#cb4-3"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb4-4"><a href="#cb4-4"></a></span>
<span id="cb4-5"><a href="#cb4-5"></a><span class="co"># put 0.7 of data into training set, use BodyTemp as stratification</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>data_split &lt;-<span class="st"> </span><span class="kw">initial_split</span>(dat.clean, </span>
<span id="cb4-7"><a href="#cb4-7"></a>                                                        <span class="dt">prop =</span> <span class="fl">0.7</span>,</span>
<span id="cb4-8"><a href="#cb4-8"></a>                                                        <span class="dt">strata =</span> BodyTemp)</span>
<span id="cb4-9"><a href="#cb4-9"></a></span>
<span id="cb4-10"><a href="#cb4-10"></a><span class="co"># create data frames for training and testing sets </span></span>
<span id="cb4-11"><a href="#cb4-11"></a>train_data &lt;-<span class="st"> </span><span class="kw">training</span>(data_split)</span>
<span id="cb4-12"><a href="#cb4-12"></a>test_data &lt;-<span class="st"> </span><span class="kw">testing</span>(data_split)</span>
<span id="cb4-13"><a href="#cb4-13"></a></span>
<span id="cb4-14"><a href="#cb4-14"></a><span class="co"># create 5-fold cross-validation, 5 times repeated</span></span>
<span id="cb4-15"><a href="#cb4-15"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb4-16"><a href="#cb4-16"></a></span>
<span id="cb4-17"><a href="#cb4-17"></a>folds &lt;-<span class="st"> </span><span class="kw">vfold_cv</span>(train_data, <span class="dt">v =</span> <span class="dv">5</span>, <span class="dt">repeats =</span><span class="dv">5</span>, <span class="dt">strata =</span> BodyTemp)</span>
<span id="cb4-18"><a href="#cb4-18"></a></span>
<span id="cb4-19"><a href="#cb4-19"></a><span class="co"># create recipe fitting BodyTemp to all predictors </span></span>
<span id="cb4-20"><a href="#cb4-20"></a>rec &lt;-<span class="st"> </span>recipes<span class="op">::</span><span class="kw">recipe</span>(BodyTemp <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_data)</span>
<span id="cb4-21"><a href="#cb4-21"></a></span>
<span id="cb4-22"><a href="#cb4-22"></a><span class="co"># create dummy variable for all predictors</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>rec_all_pred &lt;-<span class="st"> </span>rec <span class="op">%&gt;%</span></span>
<span id="cb4-24"><a href="#cb4-24"></a><span class="st">    </span><span class="co">#converts characters or factors </span></span>
<span id="cb4-25"><a href="#cb4-25"></a><span class="st">  </span><span class="kw">step_dummy</span>(<span class="kw">all_nominal</span>()) <span class="op">%&gt;%</span></span>
<span id="cb4-26"><a href="#cb4-26"></a><span class="st">    </span><span class="co">#removes indicator variables that only contain a single unique value</span></span>
<span id="cb4-27"><a href="#cb4-27"></a><span class="st">  </span><span class="kw">step_zv</span>(<span class="kw">all_predictors</span>())</span></code></pre></div>
</div>
<div id="null-model-performance" class="section level2">
<h2>Null model performance</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># fit a linear model </span></span>
<span id="cb5-2"><a href="#cb5-2"></a>lm_mod &lt;-<span class="st"> </span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="st">  </span><span class="kw">linear_reg</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">set_engine</span>(<span class="st">&quot;lm&quot;</span>)</span>
<span id="cb5-4"><a href="#cb5-4"></a></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co"># create recipe fitting BodyTemp to all predictors </span></span>
<span id="cb5-6"><a href="#cb5-6"></a>rec.null &lt;-<span class="st"> </span>recipes<span class="op">::</span><span class="kw">recipe</span>(BodyTemp <span class="op">~</span><span class="st"> </span><span class="dv">1</span>, <span class="dt">data =</span> train_data)</span>
<span id="cb5-7"><a href="#cb5-7"></a></span>
<span id="cb5-8"><a href="#cb5-8"></a><span class="co"># create model Workflow</span></span>
<span id="cb5-9"><a href="#cb5-9"></a>null_workflow &lt;-</span>
<span id="cb5-10"><a href="#cb5-10"></a><span class="st">  </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-11"><a href="#cb5-11"></a><span class="st">  </span><span class="kw">add_model</span>(lm_mod) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-12"><a href="#cb5-12"></a><span class="st">  </span><span class="kw">add_recipe</span>(rec.null)</span>
<span id="cb5-13"><a href="#cb5-13"></a></span>
<span id="cb5-14"><a href="#cb5-14"></a><span class="co"># Preparing the recipe and train the null model</span></span>
<span id="cb5-15"><a href="#cb5-15"></a>null_fit&lt;-</span>
<span id="cb5-16"><a href="#cb5-16"></a><span class="st">  </span>null_workflow <span class="op">%&gt;%</span></span>
<span id="cb5-17"><a href="#cb5-17"></a><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> train_data)</span>
<span id="cb5-18"><a href="#cb5-18"></a></span>
<span id="cb5-19"><a href="#cb5-19"></a><span class="co"># Extracting and tidying the model coefficients</span></span>
<span id="cb5-20"><a href="#cb5-20"></a>null_fit <span class="op">%&gt;%</span></span>
<span id="cb5-21"><a href="#cb5-21"></a><span class="st">  </span><span class="kw">extract_fit_parsnip</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-22"><a href="#cb5-22"></a><span class="st">  </span><span class="kw">tidy</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1 x 5
##   term        estimate std.error statistic p.value
##   &lt;chr&gt;          &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 (Intercept)     98.9    0.0537     1842.       0</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co">### Null model Evaluation</span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># we will use the RMSE as a metric to assess model performance</span></span>
<span id="cb7-3"><a href="#cb7-3"></a></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># Use a trained workflow to predict section using test data </span></span>
<span id="cb7-5"><a href="#cb7-5"></a><span class="kw">predict</span>(null_fit, test_data)</span></code></pre></div>
<pre><code>## # A tibble: 222 x 1
##    .pred
##    &lt;dbl&gt;
##  1  98.9
##  2  98.9
##  3  98.9
##  4  98.9
##  5  98.9
##  6  98.9
##  7  98.9
##  8  98.9
##  9  98.9
## 10  98.9
## # ... with 212 more rows</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a><span class="co"># include predicted probabilities</span></span>
<span id="cb9-2"><a href="#cb9-2"></a>null_test_aug &lt;-<span class="st"> </span><span class="kw">augment</span>(null_fit, test_data)</span>
<span id="cb9-3"><a href="#cb9-3"></a></span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co"># estimate RMSE for test data</span></span>
<span id="cb9-5"><a href="#cb9-5"></a>rmse_null_test &lt;-<span class="st"> </span>null_test_aug <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="st">  </span><span class="kw">rmse</span>(<span class="dt">truth =</span> BodyTemp, .pred)</span>
<span id="cb9-7"><a href="#cb9-7"></a></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co"># evaluate prediction in train data</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="kw">predict</span>(null_fit, train_data)</span></code></pre></div>
<pre><code>## # A tibble: 508 x 1
##    .pred
##    &lt;dbl&gt;
##  1  98.9
##  2  98.9
##  3  98.9
##  4  98.9
##  5  98.9
##  6  98.9
##  7  98.9
##  8  98.9
##  9  98.9
## 10  98.9
## # ... with 498 more rows</code></pre>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a><span class="co"># include predicted probabilities</span></span>
<span id="cb11-2"><a href="#cb11-2"></a>null_train_aug &lt;-<span class="st"> </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw">augment</span>(null_fit, train_data) </span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a><span class="co"># estimate RMSE for train data</span></span>
<span id="cb11-6"><a href="#cb11-6"></a>rmse_null_train &lt;-<span class="st"> </span>null_train_aug <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-7"><a href="#cb11-7"></a><span class="st">  </span><span class="kw">rmse</span>(<span class="dt">truth =</span> BodyTemp, .pred) </span>
<span id="cb11-8"><a href="#cb11-8"></a></span>
<span id="cb11-9"><a href="#cb11-9"></a>rmse_null_train</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard        1.21</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>rmse_null_test</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   .metric .estimator .estimate
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;
## 1 rmse    standard        1.16</code></pre>
</div>
<div id="model-tuning-and-fitting" class="section level1">
<h1>Model tuning and fitting</h1>
<div id="decision-tree" class="section level2">
<h2>Decision tree</h2>
<p>I first followed the tidymodels tutorial for training the model using tree regression method, but I got the error of the "“a correlation computation is required, but ‘estimate’ is constant and has…” when I used dials to search for all tuning combinations to try for each hyperparameter, and the final tree didn’t perform well, and only include sneeze as only predictor. I would like to thank Zane for the inspiration, I used “grid_latin_hypercube” for defining a grid of potential parameter values, and the codes ran without any error.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a><span class="co"># model specification </span></span>
<span id="cb15-2"><a href="#cb15-2"></a>tree_spec &lt;-<span class="st"> </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="st">  </span><span class="kw">decision_tree</span>(</span>
<span id="cb15-4"><a href="#cb15-4"></a>    <span class="dt">cost_complexity =</span> <span class="kw">tune</span>(),</span>
<span id="cb15-5"><a href="#cb15-5"></a>    <span class="dt">tree_depth =</span> <span class="kw">tune</span>(),</span>
<span id="cb15-6"><a href="#cb15-6"></a>    <span class="dt">min_n =</span> <span class="kw">tune</span>() <span class="co"># sets the minimum n to split at any node.</span></span>
<span id="cb15-7"><a href="#cb15-7"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-8"><a href="#cb15-8"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;rpart&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-9"><a href="#cb15-9"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb15-10"><a href="#cb15-10"></a></span>
<span id="cb15-11"><a href="#cb15-11"></a>tree_spec</span></code></pre></div>
<pre><code>## Decision Tree Model Specification (regression)
## 
## Main Arguments:
##   cost_complexity = tune()
##   tree_depth = tune()
##   min_n = tune()
## 
## Computational engine: rpart</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a><span class="co"># we will train this specification on several re-sampled data</span></span>
<span id="cb17-2"><a href="#cb17-2"></a>tree_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="st">  </span><span class="kw">add_model</span>(tree_spec) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="st">  </span><span class="kw">add_recipe</span>(rec_all_pred)</span>
<span id="cb17-5"><a href="#cb17-5"></a></span>
<span id="cb17-6"><a href="#cb17-6"></a></span>
<span id="cb17-7"><a href="#cb17-7"></a><span class="co"># define a grid of potential parameter values using latin hypercube sampling</span></span>
<span id="cb17-8"><a href="#cb17-8"></a>tree_grid &lt;-<span class="st"> </span><span class="kw">grid_latin_hypercube</span>(</span>
<span id="cb17-9"><a href="#cb17-9"></a>  <span class="kw">cost_complexity</span>(), <span class="kw">tree_depth</span>(), <span class="kw">min_n</span>(), <span class="dt">size =</span> <span class="dv">10</span></span>
<span id="cb17-10"><a href="#cb17-10"></a>)</span>
<span id="cb17-11"><a href="#cb17-11"></a></span>
<span id="cb17-12"><a href="#cb17-12"></a><span class="co"># Grid search for parameter values</span></span>
<span id="cb17-13"><a href="#cb17-13"></a>tree_res &lt;-<span class="st"> </span>tree_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-14"><a href="#cb17-14"></a><span class="st">  </span><span class="kw">tune_grid</span>(</span>
<span id="cb17-15"><a href="#cb17-15"></a>    <span class="dt">resamples =</span> folds,</span>
<span id="cb17-16"><a href="#cb17-16"></a>    <span class="dt">grid =</span> tree_grid,</span>
<span id="cb17-17"><a href="#cb17-17"></a>    <span class="dt">metrics =</span> <span class="kw">metric_set</span>(rmse),</span>
<span id="cb17-18"><a href="#cb17-18"></a>    <span class="dt">control =</span> <span class="kw">control_grid</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>),</span>
<span id="cb17-19"><a href="#cb17-19"></a> )</span>
<span id="cb17-20"><a href="#cb17-20"></a></span>
<span id="cb17-21"><a href="#cb17-21"></a></span>
<span id="cb17-22"><a href="#cb17-22"></a><span class="co"># Select single set of hyperparameter values for our best decision tree model</span></span>
<span id="cb17-23"><a href="#cb17-23"></a>best_tree &lt;-<span class="st"> </span><span class="kw">select_best</span>(tree_res)</span>
<span id="cb17-24"><a href="#cb17-24"></a></span>
<span id="cb17-25"><a href="#cb17-25"></a><span class="co"># Finalize our workflow with best values</span></span>
<span id="cb17-26"><a href="#cb17-26"></a>final_tree_wf &lt;-<span class="st"> </span>tree_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-27"><a href="#cb17-27"></a><span class="st">  </span><span class="kw">finalize_workflow</span>(best_tree)</span>
<span id="cb17-28"><a href="#cb17-28"></a></span>
<span id="cb17-29"><a href="#cb17-29"></a><span class="co"># Fit model to training data</span></span>
<span id="cb17-30"><a href="#cb17-30"></a>best_tree_train_fit &lt;-<span class="st"> </span>final_tree_wf <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb17-31"><a href="#cb17-31"></a><span class="st">    </span><span class="kw">fit</span>(<span class="dt">data =</span> train_data)</span>
<span id="cb17-32"><a href="#cb17-32"></a></span>
<span id="cb17-33"><a href="#cb17-33"></a></span>
<span id="cb17-34"><a href="#cb17-34"></a><span class="co"># rpart.plot::rpart.plot(</span></span>
<span id="cb17-35"><a href="#cb17-35"></a><span class="co">#   x = extract_fit_parsnip(best_tree_train_fit)$fit,</span></span>
<span id="cb17-36"><a href="#cb17-36"></a><span class="co">#   main = &quot;Final tree-based model&quot;,</span></span>
<span id="cb17-37"><a href="#cb17-37"></a><span class="co">#   roundint = F,</span></span>
<span id="cb17-38"><a href="#cb17-38"></a><span class="co">#   type = 5,</span></span>
<span id="cb17-39"><a href="#cb17-39"></a><span class="co">#   digits = 4</span></span>
<span id="cb17-40"><a href="#cb17-40"></a><span class="co"># )</span></span>
<span id="cb17-41"><a href="#cb17-41"></a></span>
<span id="cb17-42"><a href="#cb17-42"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>( here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;file&quot;</span>, <span class="st">&quot;tree_algorithms.png&quot;</span>))</span></code></pre></div>
<p><img src="file/tree_algorithms.png" width="240" /></p>
</div>
<div id="diagnostics-plots" class="section level2">
<h2>Diagnostics plots</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a><span class="co"># some more diagnostics</span></span>
<span id="cb18-2"><a href="#cb18-2"></a><span class="co"># png(filename = here::here(&quot;results&quot;, &quot;figures&quot;, &quot;tree_diagnostics.png&quot;))</span></span>
<span id="cb18-3"><a href="#cb18-3"></a><span class="co"># tree_res %&gt;% autoplot()</span></span>
<span id="cb18-4"><a href="#cb18-4"></a><span class="co"># dev.off()</span></span>
<span id="cb18-5"><a href="#cb18-5"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>( here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;file&quot;</span>, <span class="st">&quot;tree_diagnostics.png&quot;</span>))</span></code></pre></div>
<p><img src="file/tree_diagnostics.png" width="240" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="co"># pull predictions and residuals</span></span>
<span id="cb19-2"><a href="#cb19-2"></a>tree_train_res &lt;-<span class="st"> </span>best_tree_train_fit  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">new_data =</span> train_data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="st">         </span><span class="kw">select</span>(.pred, BodyTemp) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-5"><a href="#cb19-5"></a><span class="st">         </span><span class="kw">mutate</span>(<span class="dt">.resid =</span> BodyTemp <span class="op">-</span><span class="st"> </span>.pred)</span>
<span id="cb19-6"><a href="#cb19-6"></a></span>
<span id="cb19-7"><a href="#cb19-7"></a></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="co"># plot Predictions vs observed values</span></span>
<span id="cb19-9"><a href="#cb19-9"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tree_train_res, <span class="kw">aes</span>(<span class="dt">x =</span> BodyTemp, <span class="dt">y =</span> .pred)) <span class="op">+</span></span>
<span id="cb19-10"><a href="#cb19-10"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb19-11"><a href="#cb19-11"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb19-12"><a href="#cb19-12"></a><span class="st">  </span>cowplot<span class="op">::</span><span class="kw">theme_cowplot</span>() <span class="op">+</span></span>
<span id="cb19-13"><a href="#cb19-13"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb19-14"><a href="#cb19-14"></a>    <span class="dt">title =</span> <span class="st">&quot;Decision tree: predicted vs observed&quot;</span>,</span>
<span id="cb19-15"><a href="#cb19-15"></a>    <span class="dt">x =</span> <span class="st">&quot;Observed&quot;</span>,</span>
<span id="cb19-16"><a href="#cb19-16"></a>    <span class="dt">y =</span> <span class="st">&quot;Fitted&quot;</span></span>
<span id="cb19-17"><a href="#cb19-17"></a>  )</span>
<span id="cb19-18"><a href="#cb19-18"></a></span>
<span id="cb19-19"><a href="#cb19-19"></a><span class="co"># Plot model predictions vs residuals</span></span>
<span id="cb19-20"><a href="#cb19-20"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(tree_train_res, <span class="kw">aes</span>(<span class="dt">y =</span> .resid, <span class="dt">x =</span> .pred)) <span class="op">+</span></span>
<span id="cb19-21"><a href="#cb19-21"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb19-22"><a href="#cb19-22"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb19-23"><a href="#cb19-23"></a><span class="st">  </span>cowplot<span class="op">::</span><span class="kw">theme_cowplot</span>() <span class="op">+</span></span>
<span id="cb19-24"><a href="#cb19-24"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb19-25"><a href="#cb19-25"></a>    <span class="dt">title =</span> <span class="st">&quot;Decision tree: residuals vs fitted&quot;</span>,</span>
<span id="cb19-26"><a href="#cb19-26"></a>    <span class="dt">y =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb19-27"><a href="#cb19-27"></a>    <span class="dt">x =</span> <span class="st">&quot;Fitted&quot;</span></span>
<span id="cb19-28"><a href="#cb19-28"></a>  )</span>
<span id="cb19-29"><a href="#cb19-29"></a></span>
<span id="cb19-30"><a href="#cb19-30"></a><span class="co"># combine graphs</span></span>
<span id="cb19-31"><a href="#cb19-31"></a>tree_panel &lt;-<span class="st"> </span>cowplot<span class="op">::</span><span class="kw">plot_grid</span>(p1, p2, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>), <span class="dt">label_size =</span> <span class="dv">12</span>, <span class="dt">ncol =</span><span class="dv">2</span>)</span>
<span id="cb19-32"><a href="#cb19-32"></a></span>
<span id="cb19-33"><a href="#cb19-33"></a><span class="co"># ggsave(filename = here::here(&quot;results&quot;, &quot;figures&quot;, &quot;tree_panel.png&quot;),</span></span>
<span id="cb19-34"><a href="#cb19-34"></a><span class="co">#        plot = tree_panel,</span></span>
<span id="cb19-35"><a href="#cb19-35"></a><span class="co">#        width = 12, height = 6)</span></span>
<span id="cb19-36"><a href="#cb19-36"></a></span>
<span id="cb19-37"><a href="#cb19-37"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>( here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;file&quot;</span>, <span class="st">&quot;tree_panel.png&quot;</span>))</span></code></pre></div>
<p><img src="file/tree_panel.png" width="1800" /></p>
</div>
<div id="lasso-model" class="section level2">
<h2>LASSO model</h2>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1"></a><span class="co"># LASSO model specification </span></span>
<span id="cb20-2"><a href="#cb20-2"></a>lasso_spec &lt;-<span class="st"> </span></span>
<span id="cb20-3"><a href="#cb20-3"></a><span class="st">  </span><span class="kw">linear_reg</span>(</span>
<span id="cb20-4"><a href="#cb20-4"></a>    <span class="dt">penalty =</span> <span class="kw">tune</span>(),</span>
<span id="cb20-5"><a href="#cb20-5"></a>    <span class="dt">mixture =</span> <span class="dv">1</span> <span class="co"># make this LASSO</span></span>
<span id="cb20-6"><a href="#cb20-6"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-7"><a href="#cb20-7"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb20-8"><a href="#cb20-8"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb20-9"><a href="#cb20-9"></a></span>
<span id="cb20-10"><a href="#cb20-10"></a>lasso_spec</span></code></pre></div>
<pre><code>## Linear Regression Model Specification (regression)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = 1
## 
## Computational engine: glmnet</code></pre>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>lasso_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-2"><a href="#cb22-2"></a><span class="st">  </span><span class="kw">add_model</span>(lasso_spec) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="st">  </span><span class="kw">add_recipe</span>(rec_all_pred)</span>
<span id="cb22-4"><a href="#cb22-4"></a></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="co"># only one hyperparameter to tune here, we can set the grid up manually using a one-column # tibble with 30 candidate values</span></span>
<span id="cb22-6"><a href="#cb22-6"></a>lasso_grid &lt;-<span class="st"> </span><span class="kw">tibble</span>(<span class="dt">penalty =</span> <span class="dv">10</span><span class="op">^</span><span class="kw">seq</span>(<span class="op">-</span><span class="dv">4</span>, <span class="dv">-1</span>, <span class="dt">length.out =</span> <span class="dv">30</span>))</span>
<span id="cb22-7"><a href="#cb22-7"></a></span>
<span id="cb22-8"><a href="#cb22-8"></a><span class="co"># use grid search to tune hyperparameters using cross-validation </span></span>
<span id="cb22-9"><a href="#cb22-9"></a>lasso_res &lt;-<span class="st"> </span>lasso_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-10"><a href="#cb22-10"></a><span class="st">  </span>tune<span class="op">::</span><span class="kw">tune_grid</span>(</span>
<span id="cb22-11"><a href="#cb22-11"></a>    <span class="dt">resamples =</span> folds,</span>
<span id="cb22-12"><a href="#cb22-12"></a>    <span class="dt">grid =</span> lasso_grid,</span>
<span id="cb22-13"><a href="#cb22-13"></a>    <span class="dt">metrics =</span>  <span class="kw">metric_set</span>(rmse),</span>
<span id="cb22-14"><a href="#cb22-14"></a>    <span class="dt">control =</span> <span class="kw">control_grid</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb22-15"><a href="#cb22-15"></a>  )</span>
<span id="cb22-16"><a href="#cb22-16"></a></span>
<span id="cb22-17"><a href="#cb22-17"></a><span class="co"># pull the best tuning parameter values</span></span>
<span id="cb22-18"><a href="#cb22-18"></a>best_lasso &lt;-<span class="st"> </span><span class="kw">select_best</span>(lasso_res)</span>
<span id="cb22-19"><a href="#cb22-19"></a></span>
<span id="cb22-20"><a href="#cb22-20"></a><span class="co"># Finalize workflow with best values</span></span>
<span id="cb22-21"><a href="#cb22-21"></a>final_lasso_wf &lt;-<span class="st"> </span>lasso_wf  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb22-22"><a href="#cb22-22"></a><span class="st">  </span><span class="kw">finalize_workflow</span>(best_lasso)</span>
<span id="cb22-23"><a href="#cb22-23"></a></span>
<span id="cb22-24"><a href="#cb22-24"></a><span class="co"># Fit model to training data</span></span>
<span id="cb22-25"><a href="#cb22-25"></a>best_lasso_train_fit &lt;-<span class="st"> </span>final_lasso_wf <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> train_data)</span></code></pre></div>
</div>
<div id="diagnostics-plots-1" class="section level2">
<h2>Diagnostics plots</h2>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a><span class="co"># LASSO variable trace plot</span></span>
<span id="cb23-2"><a href="#cb23-2"></a>x &lt;-<span class="st"> </span>best_lasso_train_fit<span class="op">$</span>fit<span class="op">$</span>fit<span class="op">$</span>fit</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="kw">plot</span>(x, <span class="st">&quot;lambda&quot;</span>)</span></code></pre></div>
<p><img src="MLModelscript_files/figure-html/unnamed-chunk-8-1.png" width="672" /></p>
<p>You can see the plot, each colored line represents different coefficients of the predictors in the model. As lambda approaches 0, the loss function of the model will approach the OLS loss function and model includes all of the predictors. Hence, as lambda increases, the regularization term will value more and more coefficients to 0.</p>
</div>
<div id="more-diagnostics-plots" class="section level2">
<h2>More diagnostics plots</h2>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a><span class="co"># some more diagnostics</span></span>
<span id="cb24-2"><a href="#cb24-2"></a><span class="co"># png(filename = here::here(&quot;results&quot;, &quot;figures&quot;, &quot;lasso_diagnostics.png&quot;))</span></span>
<span id="cb24-3"><a href="#cb24-3"></a><span class="co"># lasso_res %&gt;% autoplot()</span></span>
<span id="cb24-4"><a href="#cb24-4"></a><span class="co"># dev.off()</span></span>
<span id="cb24-5"><a href="#cb24-5"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>( here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;file&quot;</span>, <span class="st">&quot;tree_diagnostics.png&quot;</span>))</span></code></pre></div>
<p><img src="file/tree_diagnostics.png" width="240" /></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a><span class="co"># pull predictions and residuals</span></span>
<span id="cb25-2"><a href="#cb25-2"></a>lasso_train_res &lt;-<span class="st"> </span>best_lasso_train_fit  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-3"><a href="#cb25-3"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">new_data =</span> train_data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-4"><a href="#cb25-4"></a><span class="st">         </span><span class="kw">select</span>(.pred, BodyTemp) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb25-5"><a href="#cb25-5"></a><span class="st">         </span><span class="kw">mutate</span>(<span class="dt">.resid =</span> BodyTemp <span class="op">-</span><span class="st"> </span>.pred)</span>
<span id="cb25-6"><a href="#cb25-6"></a></span>
<span id="cb25-7"><a href="#cb25-7"></a></span>
<span id="cb25-8"><a href="#cb25-8"></a><span class="co"># plot Predictions vs observed values</span></span>
<span id="cb25-9"><a href="#cb25-9"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(lasso_train_res, <span class="kw">aes</span>(<span class="dt">x =</span> BodyTemp, <span class="dt">y =</span> .pred)) <span class="op">+</span></span>
<span id="cb25-10"><a href="#cb25-10"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb25-11"><a href="#cb25-11"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="st">  </span>cowplot<span class="op">::</span><span class="kw">theme_cowplot</span>() <span class="op">+</span></span>
<span id="cb25-13"><a href="#cb25-13"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb25-14"><a href="#cb25-14"></a>    <span class="dt">title =</span> <span class="st">&quot;LASSO: predicted vs observed&quot;</span>,</span>
<span id="cb25-15"><a href="#cb25-15"></a>    <span class="dt">x =</span> <span class="st">&quot;Observed&quot;</span>,</span>
<span id="cb25-16"><a href="#cb25-16"></a>    <span class="dt">y =</span> <span class="st">&quot;Fitted&quot;</span></span>
<span id="cb25-17"><a href="#cb25-17"></a>  )</span>
<span id="cb25-18"><a href="#cb25-18"></a></span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="co"># Plot model predictions vs residuals</span></span>
<span id="cb25-20"><a href="#cb25-20"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(lasso_train_res, <span class="kw">aes</span>(<span class="dt">y =</span> .resid, <span class="dt">x =</span> .pred)) <span class="op">+</span></span>
<span id="cb25-21"><a href="#cb25-21"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb25-22"><a href="#cb25-22"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb25-23"><a href="#cb25-23"></a><span class="st">  </span>cowplot<span class="op">::</span><span class="kw">theme_cowplot</span>() <span class="op">+</span></span>
<span id="cb25-24"><a href="#cb25-24"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb25-25"><a href="#cb25-25"></a>    <span class="dt">title =</span> <span class="st">&quot;LASSO: residuals vs fitted&quot;</span>,</span>
<span id="cb25-26"><a href="#cb25-26"></a>    <span class="dt">y =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb25-27"><a href="#cb25-27"></a>    <span class="dt">x =</span> <span class="st">&quot;Fitted&quot;</span></span>
<span id="cb25-28"><a href="#cb25-28"></a>  )</span>
<span id="cb25-29"><a href="#cb25-29"></a></span>
<span id="cb25-30"><a href="#cb25-30"></a><span class="co"># combine graphs</span></span>
<span id="cb25-31"><a href="#cb25-31"></a>lasso_panel &lt;-<span class="st"> </span>cowplot<span class="op">::</span><span class="kw">plot_grid</span>(p1, p2, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>), <span class="dt">label_size =</span> <span class="dv">12</span>, <span class="dt">ncol =</span><span class="dv">2</span>)</span>
<span id="cb25-32"><a href="#cb25-32"></a></span>
<span id="cb25-33"><a href="#cb25-33"></a><span class="co"># ggsave(filename = here::here(&quot;results&quot;, &quot;figures&quot;, &quot;lasso_panel.png&quot;),</span></span>
<span id="cb25-34"><a href="#cb25-34"></a><span class="co">#        plot = lasso_panel,</span></span>
<span id="cb25-35"><a href="#cb25-35"></a><span class="co">#        width = 12, height = 6)</span></span>
<span id="cb25-36"><a href="#cb25-36"></a></span>
<span id="cb25-37"><a href="#cb25-37"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>( here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;file&quot;</span>, <span class="st">&quot;lasso_panel.png&quot;</span>))</span></code></pre></div>
<p><img src="file/lasso_panel.png" width="1800" /></p>
</div>
<div id="random-forrest" class="section level2">
<h2>Random forrest</h2>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a><span class="co"># query number of cores and see how much paralleization that can be done</span></span>
<span id="cb26-2"><a href="#cb26-2"></a>cores &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw">detectCores</span>()</span>
<span id="cb26-3"><a href="#cb26-3"></a>cores <span class="co"># 4</span></span></code></pre></div>
<pre><code>## [1] 4</code></pre>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1"></a><span class="co"># pass information to ranger engine to set up the model</span></span>
<span id="cb28-2"><a href="#cb28-2"></a>rf_mod &lt;-<span class="st"> </span></span>
<span id="cb28-3"><a href="#cb28-3"></a><span class="st">  </span><span class="kw">rand_forest</span>(<span class="dt">mtry =</span> <span class="kw">tune</span>(), <span class="dt">min_n =</span> <span class="kw">tune</span>(), <span class="dt">trees =</span> <span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-4"><a href="#cb28-4"></a><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;ranger&quot;</span>, <span class="dt">num.threads =</span> cores) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-5"><a href="#cb28-5"></a><span class="st">  </span><span class="kw">set_mode</span>(<span class="st">&quot;regression&quot;</span>)</span>
<span id="cb28-6"><a href="#cb28-6"></a></span>
<span id="cb28-7"><a href="#cb28-7"></a><span class="co"># create workflow to bundle model spec and recipe</span></span>
<span id="cb28-8"><a href="#cb28-8"></a>rf_wf &lt;-<span class="st"> </span><span class="kw">workflow</span>() <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-9"><a href="#cb28-9"></a><span class="st">  </span><span class="kw">add_model</span>(rf_mod) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb28-10"><a href="#cb28-10"></a><span class="st">  </span><span class="kw">add_recipe</span>(rec_all_pred)</span>
<span id="cb28-11"><a href="#cb28-11"></a></span>
<span id="cb28-12"><a href="#cb28-12"></a><span class="co"># show what will be tuned</span></span>
<span id="cb28-13"><a href="#cb28-13"></a>rf_mod <span class="op">%&gt;%</span><span class="st">    </span></span>
<span id="cb28-14"><a href="#cb28-14"></a><span class="st">  </span><span class="kw">parameters</span>()  </span></code></pre></div>
<pre><code>## Collection of 2 parameters for tuning
## 
##  identifier  type    object
##        mtry  mtry nparam[?]
##       min_n min_n nparam[+]
## 
## Model parameters needing finalization:
##    # Randomly Selected Predictors (&#39;mtry&#39;)
## 
## See `?dials::finalize` or `?dials::update.parameters` for more information.</code></pre>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="co"># use a space-filling design to tune, with 25 candidate models</span></span>
<span id="cb30-2"><a href="#cb30-2"></a><span class="kw">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb30-3"><a href="#cb30-3"></a>rf_res &lt;-<span class="st"> </span></span>
<span id="cb30-4"><a href="#cb30-4"></a><span class="st">  </span>rf_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-5"><a href="#cb30-5"></a><span class="st">  </span><span class="kw">tune_grid</span>(folds,</span>
<span id="cb30-6"><a href="#cb30-6"></a>            <span class="dt">grid =</span> <span class="dv">25</span>,</span>
<span id="cb30-7"><a href="#cb30-7"></a>            <span class="dt">control =</span> <span class="kw">control_grid</span>(<span class="dt">save_pred =</span> <span class="ot">TRUE</span>),</span>
<span id="cb30-8"><a href="#cb30-8"></a>            <span class="dt">metrics =</span> <span class="kw">metric_set</span>(rmse))</span>
<span id="cb30-9"><a href="#cb30-9"></a></span>
<span id="cb30-10"><a href="#cb30-10"></a><span class="co"># 5 random forest models, out of the 25 candidates:</span></span>
<span id="cb30-11"><a href="#cb30-11"></a>rf_res <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb30-12"><a href="#cb30-12"></a><span class="st">  </span><span class="kw">show_best</span>(<span class="dt">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 8
##    mtry min_n .metric .estimator  mean     n std_err .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                
## 1     8    37 rmse    standard    1.16    25  0.0167 Preprocessor1_Model25
## 2     3    23 rmse    standard    1.16    25  0.0165 Preprocessor1_Model13
## 3    13    35 rmse    standard    1.17    25  0.0166 Preprocessor1_Model15
## 4     4    14 rmse    standard    1.17    25  0.0164 Preprocessor1_Model06
## 5     2    33 rmse    standard    1.17    25  0.0168 Preprocessor1_Model10</code></pre>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="co"># select the best model according to RMSE metric, and the final tuning parameter values are:</span></span>
<span id="cb32-2"><a href="#cb32-2"></a>best_rf &lt;-<span class="st"> </span></span>
<span id="cb32-3"><a href="#cb32-3"></a><span class="st">  </span>rf_res <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb32-4"><a href="#cb32-4"></a><span class="st">  </span><span class="kw">select_best</span>(<span class="dt">metric =</span> <span class="st">&quot;rmse&quot;</span>)</span>
<span id="cb32-5"><a href="#cb32-5"></a></span>
<span id="cb32-6"><a href="#cb32-6"></a>best_rf</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##    mtry min_n .config              
##   &lt;int&gt; &lt;int&gt; &lt;chr&gt;                
## 1     8    37 Preprocessor1_Model25</code></pre>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a><span class="co"># Finalize workflow with best values</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>final_rf_wf &lt;-<span class="st"> </span>rf_wf  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="st">  </span><span class="kw">finalize_workflow</span>(best_rf)</span>
<span id="cb34-4"><a href="#cb34-4"></a></span>
<span id="cb34-5"><a href="#cb34-5"></a><span class="co"># Fit model to training data</span></span>
<span id="cb34-6"><a href="#cb34-6"></a>best_rf_train_fit &lt;-<span class="st"> </span>final_rf_wf <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">fit</span>(<span class="dt">data =</span> train_data)</span></code></pre></div>
</div>
<div id="diagnostics-plots-2" class="section level2">
<h2>Diagnostics plots</h2>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a><span class="co"># some more diagnostics</span></span>
<span id="cb35-2"><a href="#cb35-2"></a><span class="co"># png(filename = here::here(&quot;results&quot;, &quot;figures&quot;, &quot;random_forest_diagnostics.png&quot;))</span></span>
<span id="cb35-3"><a href="#cb35-3"></a><span class="co"># rf_res %&gt;% autoplot()</span></span>
<span id="cb35-4"><a href="#cb35-4"></a><span class="co"># dev.off()</span></span>
<span id="cb35-5"><a href="#cb35-5"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>( here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;file&quot;</span>, <span class="st">&quot;random_forest_diagnostics.png&quot;</span>))</span></code></pre></div>
<p><img src="file/random_forest_diagnostics.png" width="240" /></p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a><span class="co"># pull predictions and residuals</span></span>
<span id="cb36-2"><a href="#cb36-2"></a>rf_train_res &lt;-<span class="st"> </span>best_rf_train_fit  <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-3"><a href="#cb36-3"></a><span class="st">  </span><span class="kw">augment</span>(<span class="dt">new_data =</span> train_data) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-4"><a href="#cb36-4"></a><span class="st">         </span><span class="kw">select</span>(.pred, BodyTemp) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb36-5"><a href="#cb36-5"></a><span class="st">         </span><span class="kw">mutate</span>(<span class="dt">.resid =</span> BodyTemp <span class="op">-</span><span class="st"> </span>.pred)</span>
<span id="cb36-6"><a href="#cb36-6"></a></span>
<span id="cb36-7"><a href="#cb36-7"></a></span>
<span id="cb36-8"><a href="#cb36-8"></a><span class="co"># plot Predictions vs observed values</span></span>
<span id="cb36-9"><a href="#cb36-9"></a>p1 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(rf_train_res, <span class="kw">aes</span>(<span class="dt">x =</span> BodyTemp, <span class="dt">y =</span> .pred)) <span class="op">+</span></span>
<span id="cb36-10"><a href="#cb36-10"></a><span class="st">  </span><span class="kw">geom_abline</span>(<span class="dt">slope =</span> <span class="dv">1</span>, <span class="dt">intercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb36-11"><a href="#cb36-11"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb36-12"><a href="#cb36-12"></a><span class="st">  </span>cowplot<span class="op">::</span><span class="kw">theme_cowplot</span>() <span class="op">+</span></span>
<span id="cb36-13"><a href="#cb36-13"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb36-14"><a href="#cb36-14"></a>    <span class="dt">title =</span> <span class="st">&quot;Random forest: predicted vs observed&quot;</span>,</span>
<span id="cb36-15"><a href="#cb36-15"></a>    <span class="dt">x =</span> <span class="st">&quot;Observed&quot;</span>,</span>
<span id="cb36-16"><a href="#cb36-16"></a>    <span class="dt">y =</span> <span class="st">&quot;Fitted&quot;</span></span>
<span id="cb36-17"><a href="#cb36-17"></a>  )</span>
<span id="cb36-18"><a href="#cb36-18"></a></span>
<span id="cb36-19"><a href="#cb36-19"></a><span class="co"># Plot model predictions vs residuals</span></span>
<span id="cb36-20"><a href="#cb36-20"></a>p2 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(rf_train_res, <span class="kw">aes</span>(<span class="dt">y =</span> .resid, <span class="dt">x =</span> .pred)) <span class="op">+</span></span>
<span id="cb36-21"><a href="#cb36-21"></a><span class="st">  </span><span class="kw">geom_hline</span>(<span class="dt">yintercept =</span> <span class="dv">0</span>, <span class="dt">color =</span> <span class="st">&quot;red&quot;</span>, <span class="dt">lty =</span> <span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb36-22"><a href="#cb36-22"></a><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></span>
<span id="cb36-23"><a href="#cb36-23"></a><span class="st">  </span>cowplot<span class="op">::</span><span class="kw">theme_cowplot</span>() <span class="op">+</span></span>
<span id="cb36-24"><a href="#cb36-24"></a><span class="st">  </span><span class="kw">labs</span>(</span>
<span id="cb36-25"><a href="#cb36-25"></a>    <span class="dt">title =</span> <span class="st">&quot;Random forest: residuals vs fitted&quot;</span>,</span>
<span id="cb36-26"><a href="#cb36-26"></a>    <span class="dt">y =</span> <span class="st">&quot;Residuals&quot;</span>,</span>
<span id="cb36-27"><a href="#cb36-27"></a>    <span class="dt">x =</span> <span class="st">&quot;Fitted&quot;</span></span>
<span id="cb36-28"><a href="#cb36-28"></a>  )</span>
<span id="cb36-29"><a href="#cb36-29"></a></span>
<span id="cb36-30"><a href="#cb36-30"></a><span class="co"># combine graphs</span></span>
<span id="cb36-31"><a href="#cb36-31"></a>random_forest_panel &lt;-<span class="st"> </span>cowplot<span class="op">::</span><span class="kw">plot_grid</span>(p1, p2, <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&#39;A&#39;</span>, <span class="st">&#39;B&#39;</span>), <span class="dt">label_size =</span> <span class="dv">12</span>, <span class="dt">ncol =</span><span class="dv">2</span>)</span>
<span id="cb36-32"><a href="#cb36-32"></a></span>
<span id="cb36-33"><a href="#cb36-33"></a><span class="co"># ggsave(filename = here::here(&quot;results&quot;, &quot;figures&quot;, &quot;random_forest_panel.png&quot;),</span></span>
<span id="cb36-34"><a href="#cb36-34"></a><span class="co">#        plot = random_forest_panel,</span></span>
<span id="cb36-35"><a href="#cb36-35"></a><span class="co">#        width = 12, height = 6)</span></span>
<span id="cb36-36"><a href="#cb36-36"></a></span>
<span id="cb36-37"><a href="#cb36-37"></a>knitr<span class="op">::</span><span class="kw">include_graphics</span>( here<span class="op">::</span><span class="kw">here</span>(<span class="st">&quot;file&quot;</span>, <span class="st">&quot;random_forest_panel.png&quot;</span>))</span></code></pre></div>
<p><img src="file/random_forest_panel.png" width="1800" /></p>
</div>
<div id="model-selection" class="section level2">
<h2>Model selection</h2>
<p>We can see that LASSO had better fit compared to both decision tree and random forest methods. Looking at the predicted values vs observed plot for the decision tree, it only predicts four distinct values of the body temperature, and other two methods did better. However, there are also some issue with predicting higher body temperature. So, I will fit the choosen LASSO model to the test data and evaluate the performance.</p>
</div>
<div id="final-evaluation" class="section level2">
<h2>Final evaluation</h2>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a><span class="co"># evaluate how model perform on test set</span></span>
<span id="cb37-2"><a href="#cb37-2"></a>last_rf_fit &lt;-<span class="st"> </span>final_lasso_wf <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-3"><a href="#cb37-3"></a><span class="st">  </span><span class="kw">last_fit</span>(<span class="dt">split =</span> data_split, </span>
<span id="cb37-4"><a href="#cb37-4"></a>                 <span class="dt">metrics =</span> <span class="kw">metric_set</span>(rmse))</span>
<span id="cb37-5"><a href="#cb37-5"></a></span>
<span id="cb37-6"><a href="#cb37-6"></a>last_rf_fit <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb37-7"><a href="#cb37-7"></a><span class="st">  </span><span class="kw">collect_metrics</span>()</span></code></pre></div>
<pre><code>## # A tibble: 1 x 4
##   .metric .estimator .estimate .config             
##   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 rmse    standard        1.15 Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a><span class="co"># rmse for LASSO model fitting on testing data</span></span>
<span id="cb39-2"><a href="#cb39-2"></a>lasso_test_rmse &lt;-<span class="st"> </span><span class="kw">collect_metrics</span>(last_rf_fit) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-3"><a href="#cb39-3"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">select</span>(<span class="dt">rmse =</span> .estimate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-4"><a href="#cb39-4"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">mutate</span>(<span class="dt">data =</span> <span class="st">&quot;testing&quot;</span>)</span>
<span id="cb39-5"><a href="#cb39-5"></a></span>
<span id="cb39-6"><a href="#cb39-6"></a><span class="co"># rmse for LASSO model fitting on training data  </span></span>
<span id="cb39-7"><a href="#cb39-7"></a>lasso_RMSE_train &lt;-<span class="st"> </span>lasso_res <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-8"><a href="#cb39-8"></a><span class="st">  </span><span class="kw">show_best</span>(<span class="dt">n =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-9"><a href="#cb39-9"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">transmute</span>(</span>
<span id="cb39-10"><a href="#cb39-10"></a>    <span class="dt">rmse =</span> <span class="kw">round</span>(mean, <span class="dv">4</span>),</span>
<span id="cb39-11"><a href="#cb39-11"></a>    <span class="dt">SE =</span> <span class="kw">round</span>(std_err, <span class="dv">4</span>),</span>
<span id="cb39-12"><a href="#cb39-12"></a>    <span class="dt">model =</span> <span class="st">&quot;LASSO&quot;</span></span>
<span id="cb39-13"><a href="#cb39-13"></a>  ) </span>
<span id="cb39-14"><a href="#cb39-14"></a></span>
<span id="cb39-15"><a href="#cb39-15"></a>lasso_RMSE_train <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-16"><a href="#cb39-16"></a><span class="st">  </span>dplyr<span class="op">::</span><span class="kw">transmute</span>(</span>
<span id="cb39-17"><a href="#cb39-17"></a>    rmse, <span class="dt">data =</span> <span class="st">&quot;training&quot;</span></span>
<span id="cb39-18"><a href="#cb39-18"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-19"><a href="#cb39-19"></a><span class="st">  </span><span class="kw">bind_rows</span>(lasso_test_rmse) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb39-20"><a href="#cb39-20"></a><span class="st">  </span>gt<span class="op">::</span><span class="kw">gt</span>(<span class="dt">caption =</span> <span class="st">&quot;Comparison of RMSE between traing and testing data using LASSO regression.&quot;</span>)</span></code></pre></div>
<div id="xrkpusbwqi" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xrkpusbwqi .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xrkpusbwqi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xrkpusbwqi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xrkpusbwqi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xrkpusbwqi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xrkpusbwqi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xrkpusbwqi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xrkpusbwqi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xrkpusbwqi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xrkpusbwqi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xrkpusbwqi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xrkpusbwqi .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xrkpusbwqi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xrkpusbwqi .gt_from_md > :first-child {
  margin-top: 0;
}

#xrkpusbwqi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xrkpusbwqi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xrkpusbwqi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#xrkpusbwqi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xrkpusbwqi .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#xrkpusbwqi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xrkpusbwqi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xrkpusbwqi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xrkpusbwqi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xrkpusbwqi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xrkpusbwqi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#xrkpusbwqi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xrkpusbwqi .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#xrkpusbwqi .gt_left {
  text-align: left;
}

#xrkpusbwqi .gt_center {
  text-align: center;
}

#xrkpusbwqi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xrkpusbwqi .gt_font_normal {
  font-weight: normal;
}

#xrkpusbwqi .gt_font_bold {
  font-weight: bold;
}

#xrkpusbwqi .gt_font_italic {
  font-style: italic;
}

#xrkpusbwqi .gt_super {
  font-size: 65%;
}

#xrkpusbwqi .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  <caption>Comparison of RMSE between traing and testing data using LASSO regression.</caption>
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_right" rowspan="1" colspan="1">rmse</th>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1">data</th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_right">1.157100</td>
<td class="gt_row gt_left">training</td></tr>
    <tr><td class="gt_row gt_right">1.152456</td>
<td class="gt_row gt_left">testing</td></tr>
  </tbody>
  
  
</table>
</div>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a><span class="kw">tidy</span>(<span class="kw">extract_model</span>(best_lasso_train_fit)) <span class="op">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2"></a><span class="st">  </span><span class="kw">filter</span>(lambda <span class="op">&gt;</span><span class="st"> </span><span class="fl">0.01</span> <span class="op">&amp;</span><span class="st"> </span>lambda <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.03</span>)</span></code></pre></div>
<pre><code>## Warning: `extract_model()` was deprecated in tune 0.1.6.
## Please use `extract_fit_engine()` instead.</code></pre>
<pre><code>## # A tibble: 298 x 5
##    term         step estimate lambda dev.ratio
##    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;
##  1 (Intercept)    25     98.4 0.0292     0.154
##  2 (Intercept)    26     98.4 0.0266     0.157
##  3 (Intercept)    27     98.3 0.0242     0.158
##  4 (Intercept)    28     98.3 0.0221     0.160
##  5 (Intercept)    29     98.3 0.0201     0.161
##  6 (Intercept)    30     98.3 0.0183     0.163
##  7 (Intercept)    31     98.3 0.0167     0.164
##  8 (Intercept)    32     98.2 0.0152     0.165
##  9 (Intercept)    33     98.2 0.0139     0.165
## 10 (Intercept)    34     98.2 0.0126     0.166
## # ... with 288 more rows</code></pre>
<p>The result shows that the final LASSO model fits were similar between training and testing data. However, this model doesn’t seem to perform any better than the Null model.</p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
